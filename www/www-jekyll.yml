# Update the static website

- hosts: www

  # TODO: Remove these pre-tasks after the new archive is deployed to
  # production for the first time
  pre_tasks:

  - name: Check for old deployment directory
    stat:
      path: "{{ deploy_archive_symlink }}"
    register: _archive_symlink_st

  - name: Rename old deployment directory if present
    become: yes
    command: mv "{{ deploy_archive_symlink }}" "{{ deploy_archive_symlink }}.old-jekyll-deploy"
    when: _archive_symlink_st.stat.exists and _archive_symlink_st.stat.isdir

  roles:
  - role: openmicroscopy.deploy_archive
    become: yes
    tags: jekyll

  vars:
    website_version: "2018.07.12"
    website_name: www.openmicroscopy.org
    deploy_archive_dest_dir: /var/www/{{ website_name }}/{{ website_version }}
    deploy_archive_src_url: https://github.com/opemicroscopy/{{ website_name }}/releases/download/{{ website_version }}/{{ website_name }}.tar.gz
    # Optional checksum. It should be safe to omit as long as you never
    # overwrite an existing archive. This should not be a problem when using
    # versioned directories.
    deploy_archive_sha256: 39978fb327ceae0d56f65e66a160f4b849b6d45123311b92e38ca05ae140026d.
    deploy_archive_symlink: /var/www/{{ website_name }}/html
